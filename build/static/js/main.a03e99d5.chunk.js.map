{"version":3,"sources":["common.js","Note.jsx","Matrix.jsx","App.js","index.js"],"names":["INACTIVE_OPACITY","INITIAL_DELAY","sound","Tone","envelope","releaseCurve","toDestination","lookAhead","clearAllTimeouts","id","window","setTimeout","clearTimeout","elementsMap","Map","AllNotes","Note","i","j","note","sheet","mod","volume","speed","imported","currentNote","delay","x","y","size","useState","opacity","setOpacity","c","toString","toUpperCase","substring","length","intToRGB","str","hash","charCodeAt","hashCode","color","value","style","ref","element","set","className","title","onClick","triggerAttackRelease","transform","backgroundColor","Matrix","v","setMod","width","setWidth","offset","setOffset","shift","setShift","setVolume","Notes","setSpeed","pagination","setPagination","setSize","setSheet","reload","setReload","load","setLoad","currentMusic","setCurrentMusic","isMusicListOpen","setIsMusicListOpen","screenshotCanvas","setScreenshotCanvas","isScreenshotShown","setScreenshotIsShow","resize","initial","bounds","setBounds","useLayoutEffect","updateSize","w","Math","floor","innerWidth","h","innerHeight","addEventListener","removeEventListener","useWindowSize","callibrateNotes","editMode","pages","Object","values","reduce","acc","n","max","iteratePages","page","playInterval","localMax","Infinity","sheetArr","map","get","firstChild","index","JSON","stringify","forEach","useEffect","onKeyDown","e","preventDefault","stopPropagation","key","toLowerCase","document","onChange","target","min","textAlign","fontSize","val","type","step","amount","adjustVolume","html2canvas","querySelector","canvas","onclone","_","notes","querySelectorAll","then","handler","getElementById","innerHTML","appendChild","history","replaceState","current","includes","parse","position","display","gridTemplateColumns","repeat","Array","fill","row","col","App","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.a03e99d5.chunk.js","sourcesContent":["import * as Tone from 'tone'\nexport const INACTIVE_OPACITY = '0.2'\nexport const ACTIVE_OPACITY = '1'\nexport const INITIAL_DELAY = 100\nexport const SECOND = 1000\nexport const getNoteId = (note) => `${note.x}:${note.y}`\nexport const hashCode = (str) => {\n  let hash = 0\n  for (let i = 0; i < str.length; i++)\n    hash = str.charCodeAt(i) + ((hash << 5) - hash)\n  return hash\n}\nexport const intToRGB = (i) => {\n  const c = (i & 0x00ffffff).toString(16).toUpperCase()\n  return '000000'.substring(0, 6 - c.length) + c\n}\nexport const matrix = (x, y, v) =>\n  Array(x)\n    .fill(v)\n    .map((_) => Array(y).fill(v))\n\nexport const sound = new Tone.PolySynth(Tone.Synth, {\n  envelope: {\n    releaseCurve: 'sine',\n  },\n})\n  // .connect(new Tone.AutoPanner('8n').toDestination())\n  // .connect(new Tone.Distortion(2.8).toDestination())\n  // .connect(new Tone.Chorus(4, 3.5, 0.5).toDestination())\n  // .connect(new Tone.Tremolo(9, 0.75).toDestination())\n  // .connect(new Tone.Vibrato(9, 0.75).toDestination())\n  .toDestination()\nTone.context.lookAhead = 0.2\nexport const clearAllTimeouts = () => {\n  let id = window.setTimeout(() => {}, 0)\n  while (id--) {\n    window.clearTimeout(id)\n  }\n}\nexport const elementsMap = new Map()\nexport const AllNotes = [\n  'A0',\n  'B0',\n  'C1',\n  'D1',\n  'E1',\n  'F1',\n  'G1',\n  'A1',\n  'B1',\n  'C2',\n  'D2',\n  'E2',\n  'F2',\n  'G2',\n  'A2',\n  'B2',\n  'C3',\n  'D3',\n  'E3',\n  'F3',\n  'G3',\n  'A3',\n  'B3',\n  'C4',\n  'D4',\n  'E4',\n  'F4',\n  'G4',\n  'A4',\n  'B4',\n  'C5',\n  'D5',\n  'E5',\n  'F5',\n  'G5',\n  'A5',\n  'B5',\n  'C6',\n  'A6',\n  'B6',\n  'C7',\n  'D7',\n  'E7',\n  'F7',\n  'G7',\n  'A7',\n  'B7',\n  'B8',\n]\n","import React, { useState } from 'react'\nimport {\n  ACTIVE_OPACITY,\n  INACTIVE_OPACITY,\n  elementsMap,\n  hashCode,\n  intToRGB,\n} from './common'\n\nconst Note = ({ i, j, note, sound, sheet, mod, volume, speed }) => {\n  const id = `${i}:${j}`\n  const imported = sheet[id] || null\n  const currentNote = imported ? sheet[id] : { delay: 0.1, x: i, y: j }\n  const delay = currentNote.delay\n  const size = currentNote.delay > 0.1 ? currentNote.delay + 1 : 1\n  // const [delay, setDelay] = useState(currentNote.delay);\n  // const [size, setSize] = useState(\n  //   currentNote.delay > 0.1 ? currentNote.delay + 1 : 1\n  // );\n\n  const [opacity, setOpacity] = useState(\n    imported ? ACTIVE_OPACITY : INACTIVE_OPACITY\n  )\n  const [color] = useState('#' + intToRGB(hashCode(note + '1230')))\n  if (imported) {\n    sheet[id] = currentNote\n    sheet[id].value = note\n  }\n  return (\n    <button\n      style={{ opacity }}\n      ref={(element) => {\n        if (element !== null && i < mod) elementsMap.set(id, element)\n      }}\n      className=\"note-button\"\n      id={id}\n      title={note}\n      // onKeyPress={e => {\n      //   if (e.key === '=') {\n      //     setDelay(Math.max(0, delay + 0.05));\n      //     setSize(delay + 1);\n      //   } else if (e.key === '-') {\n      //     setDelay(Math.max(0, delay - 0.05));\n      //     setSize(delay + 1);\n      //   }\n      // }}\n      onClick={() => {\n        const id = `${i}:${j}`\n        if (sheet[id]) {\n          setOpacity(INACTIVE_OPACITY)\n          delete sheet[id]\n        } else {\n          setOpacity('1')\n          sound.volume.value = volume - 30\n          sound.triggerAttackRelease(note, delay * speed)\n          sheet[id] = { value: note, delay, x: i, y: j }\n        }\n      }}\n    >\n      <div\n        style={{\n          transform: `scale(1, ${size})`,\n          backgroundColor: color,\n        }}\n        className=\"shape\"\n      ></div>\n    </button>\n  )\n}\nexport default Note\n","import {\n  elementsMap,\n  AllNotes,\n  matrix,\n  sound,\n  clearAllTimeouts,\n  INACTIVE_OPACITY,\n  INITIAL_DELAY,\n  SECOND,\n  ACTIVE_OPACITY,\n} from './common.js'\nimport React, { useState, useEffect, useLayoutEffect } from 'react'\nimport * as html2canvas from 'html2canvas'\nimport Note from './Note.jsx'\n\nconst useWindowSize = (initial) => {\n  const [bounds, setBounds] = useState(initial)\n  useLayoutEffect(() => {\n    const updateSize = () => {\n      setBounds({\n        w: Math.floor(window.innerWidth / 50),\n        h: Math.floor(window.innerHeight / 45),\n      })\n    }\n    window.addEventListener('resize', updateSize)\n    updateSize()\n    return () => window.removeEventListener('resize', updateSize)\n  }, [])\n  return bounds\n}\n\nconst Matrix = () => {\n  const [mod, setMod] = useState(15)\n  const [width, setWidth] = useState(30)\n  const [offset, setOffset] = useState(15)\n  const [shift, setShift] = useState(0)\n  const [volume, setVolume] = useState(30)\n  const [Notes] = useState(AllNotes) //.slice(shift, offset + width)\n  const [speed, setSpeed] = useState(0.25)\n  const [pagination, setPagination] = useState(0)\n  const [size, setSize] = useState(15)\n  const [sheet, setSheet] = useState({})\n  const [reload, setReload] = useState(true)\n  const [load, setLoad] = useState(false)\n  const [currentMusic, setCurrentMusic] = useState('')\n  const [isMusicListOpen, setIsMusicListOpen] = useState(false)\n  const [screenshotCanvas, setScreenshotCanvas] = useState()\n  const [isScreenshotShown, setScreenshotIsShow] = useState(false)\n\n  const resize = useWindowSize({ w: width, h: mod })\n\n  const adjustVolume = (volume) => setVolume(volume)\n\n  const addMusicFromList = (current) => {\n    setLoad(false)\n    setSpeed(current.speed)\n    setOffset(current.offset)\n    setShift(current.shift)\n    setSheet(current.sheet)\n    setIsMusicListOpen(false)\n    callibrateNotes(current.sheet)\n    // setCurrentMusic(JSON.stringify(current));\n  }\n  const callibrateNotes = (sheet) => {\n    editMode()\n    let pages = Math.floor(\n      Object.values(sheet).reduce((acc, n) => (acc = Math.max(acc, n.x)), 0) /\n        mod\n    )\n    const iteratePages = (page) => {\n      setLoad(false)\n      if (page <= pages) {\n        setPagination(size * page)\n        setTimeout(() => iteratePages(++page), 150)\n      } else setPagination(0)\n      setLoad(true)\n    }\n    iteratePages(0)\n  }\n\n  const offsetNotes = (value) => {\n    setLoad(false)\n    callibrateNotes(sheet)\n    setReload(!reload)\n  }\n  const clearNotes = () => {\n    clearAllTimeouts()\n    setSheet({})\n    setPagination(0)\n    setLoad(false)\n    setReload(!reload)\n    // eslint-disable-next-line no-restricted-globals\n    history.replaceState({}, null, '/')\n  }\n\n  const playInterval = () => {\n    let localMax = -Infinity\n    setTimeout(() => {\n      if (size !== mod) setSize(mod)\n      clearAllTimeouts()\n      const sheetArr = Object.values(sheet).map((note) => {\n        const { x, y } = note\n        const element = elementsMap.get(`${(x + pagination) % mod}:${y}`)\n        if (element) {\n          element.style.opacity = INACTIVE_OPACITY\n          element.firstChild.style.transform = `scale(1)`\n        }\n        localMax = Math.max(localMax, x)\n        return { note, element, index: x }\n      })\n\n      for (let i = 0; i < localMax; i++)\n        if (!sheetArr[i]) sheetArr[i] = { note: null, element: null, index: i }\n      setCurrentMusic(JSON.stringify({ sheet, offset, speed, shift }))\n      sheetArr.forEach(\n        ({ note, element, index }) =>\n          note &&\n          setTimeout(() => {\n            const { value, delay } = note\n            sound.volume.value = volume - 30\n            sound.triggerAttackRelease(value, Math.max(delay * speed, 0.1))\n            if (element) element.style.opacity = ACTIVE_OPACITY\n            // element.firstChild.style.transform = `scale(1, ${\n            //   delay > 0.1 ? delay + 1 : 1\n            // })`\n            setTimeout(() => {\n              if (element)\n                setTimeout(() => {\n                  element.style.opacity = INACTIVE_OPACITY\n                  element.firstChild.style.transform = `scale(1)`\n                }, (speed * delay + 1) * INITIAL_DELAY + INITIAL_DELAY)\n              index === localMax && setTimeout(() => playInterval(), SECOND)\n            }, (speed * delay + 1) * INITIAL_DELAY)\n          }, speed * index * SECOND + INITIAL_DELAY * 2)\n      )\n    }, INITIAL_DELAY * (pagination === 0 ? 1 : 5))\n  }\n\n  const editMode = () => {\n    setLoad(false)\n    clearAllTimeouts()\n    setReload(!reload)\n  }\n\n  useEffect(() => {\n    const onKeyDown = (e) => {\n      e.preventDefault()\n      e.stopPropagation()\n      switch (e.key.toLowerCase()) {\n        case 'w':\n          if (pagination <= 0) return\n          setLoad(false)\n          setPagination(pagination - size)\n          setLoad(true)\n          break\n        case 's':\n          setLoad(false)\n          setPagination(size + pagination)\n          setLoad(true)\n          break\n        case 'a':\n          setShift(shift - 1)\n          break\n        case 'd':\n          setShift(shift + 1)\n          break\n        case 'e':\n          if (pagination !== 0) {\n            setLoad(false)\n            setPagination(0)\n            setLoad(true)\n          } else playInterval()\n          break\n        case 'q':\n          setLoad(false)\n          clearAllTimeouts()\n          setLoad(true)\n          break\n        // case 'enter':\n        //   if (e.target.value.includes('sheet'))\n        //     addMusicFromList(JSON.parse(e.target.value))\n        //   break\n        default:\n          break\n      }\n    }\n    document.addEventListener('keydown', onKeyDown)\n    return () => document.removeEventListener('keydown', onKeyDown)\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [shift, pagination])\n\n  useEffect(() => {\n    setLoad(false)\n    setWidth(resize.w)\n    setMod(resize.h)\n    setLoad(true)\n  }, [resize.w, resize.h])\n\n  useEffect(() => setLoad(true), [reload])\n\n  return (\n    <div>\n      <div className={`options  ${isMusicListOpen ? 'blured' : ''}`}>\n        <div className=\"menu\">\n          <button\n            className=\"ui label\"\n            title=\"shift right\"\n            onClick={() => {\n              setShift(shift + 1)\n            }}\n          >\n            {'>>'}\n          </button>\n          <input\n            className=\"ui\"\n            onChange={(e) => setShift(+e.target.value || 0)}\n            title=\"shift\"\n            value={shift}\n            min={-AllNotes.length}\n            max={AllNotes.length}\n            style={{\n              width: 25,\n              textAlign: 'center',\n              fontSize: 10,\n            }}\n          />\n          <button\n            className=\"ui label\"\n            title=\"shift left\"\n            onClick={() => setShift(shift - 1)}\n          >\n            {'<<'}\n          </button>\n          <input\n            title=\"offset\"\n            className=\"ui\"\n            onChange={(e) => {\n              const val = +e.target.value\n              setOffset(val)\n              offsetNotes(offset)\n            }}\n            value={offset}\n            type=\"number\"\n            min={0}\n            max={AllNotes.length}\n            style={{\n              width: 40,\n              textAlign: 'center',\n              fontSize: 10,\n            }}\n          />\n          <input\n            className=\"ui\"\n            title=\"change speed\"\n            onChange={(e) => setSpeed(+e.target.value)}\n            step=\"0.1\"\n            type=\"number\"\n            style={{\n              width: 80,\n              fontSize: 10,\n              textAlign: 'center',\n            }}\n            value={speed}\n          />\n\n          <input\n            className=\"ui\"\n            onChange={(e) => {\n              const amount = +e.target.value\n              if (amount >= 0 && amount <= 100) adjustVolume(amount)\n            }}\n            title=\"volume\"\n            value={volume}\n            type=\"number\"\n            min={0}\n            max={100}\n            style={{\n              width: 50,\n              textAlign: 'center',\n              fontSize: 10,\n            }}\n          />\n          <button\n            onClick={() => {\n              setScreenshotIsShow(false)\n              html2canvas(document.querySelector('.matrix'), {\n                backgroundColor: 'transparent',\n                canvas: screenshotCanvas,\n                onclone: (_, element) => {\n                  const notes = element.querySelectorAll('.note-button')\n                  for (const note of notes)\n                    if (note.style.opacity === INACTIVE_OPACITY)\n                      note.style.opacity = '0'\n                },\n              }).then((canvas) => {\n                if (!screenshotCanvas) {\n                  const handler = document.getElementById('screenshotHandler')\n                  handler.innerHTML = ''\n                  handler.appendChild(canvas)\n                } else setScreenshotCanvas(screenshotCanvas)\n                setScreenshotIsShow(true)\n              })\n            }}\n            className=\"ui label\"\n          >\n            ghost\n          </button>\n          <button\n            onClick={() => setScreenshotIsShow(!isScreenshotShown)}\n            className=\"ui label\"\n          >\n            {isScreenshotShown ? 'hide' : 'show'}\n          </button>\n        </div>\n\n        <div className=\"tools\">\n          <button\n            onClick={() => {\n              if (pagination !== 0) {\n                setPagination(0)\n                setLoad(false)\n                setReload(!reload)\n              } else playInterval()\n            }}\n            title=\"play\"\n            className=\"ui\"\n          >\n            {'>'}\n          </button>\n          <button\n            onClick={editMode}\n            title=\"stop\"\n            className=\"ui\"\n            style={{\n              fontSize: 20,\n            }}\n          >\n            #\n          </button>\n\n          <button\n            onClick={() => {\n              if (pagination <= 0) return\n              setLoad(false)\n              setPagination(pagination - size)\n              setReload(!reload)\n            }}\n            title=\"up\"\n            className=\"ui\"\n          >\n            &#9650;\n          </button>\n          <button title=\"page\" className=\"ui\">\n            {pagination / size}\n          </button>\n          <button\n            title=\"down\"\n            onClick={(e) => {\n              setLoad(false)\n              setPagination(size + pagination)\n              setReload(!reload)\n            }}\n            className=\"ui\"\n          >\n            &#9660;\n          </button>\n\n          <button title=\"erase\" className=\"ui\" onClick={() => clearNotes()}>\n            x\n          </button>\n\n          <input\n            title=\"title\"\n            onChange={(e) => {\n              if (e.target.value.includes('sheet')) {\n                setCurrentMusic(e.target.value)\n                addMusicFromList(JSON.parse(e.target.value))\n              }\n            }}\n            value={currentMusic}\n            className=\"ui title\"\n          />\n        </div>\n      </div>\n      <div\n        id=\"screenshotHandler\"\n        style={{\n          position: 'absolute',\n          display: isScreenshotShown ? 'block' : 'none',\n        }}\n      ></div>\n      {load && (\n        <div\n          className={`matrix ${isMusicListOpen ? 'blured' : ''}`}\n          style={{ gridTemplateColumns: 'auto '.repeat(width) }}\n        >\n          {matrix(mod, width, null).map((row, i) =>\n            row.map((col, j) => (\n              <Note\n                i={i + pagination}\n                j={j - shift}\n                key={i + '-' + (j - shift)}\n                note={Notes[j - shift + offset]}\n                sound={sound}\n                sheet={sheet}\n                speed={speed}\n                mod={mod}\n                volume={volume}\n              />\n            ))\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default Matrix\n","import React from 'react'\nimport './App.css'\nimport Matrix from './Matrix.jsx'\n\nconst App = () => (\n  <div className=\"App\">\n    <Matrix />\n  </div>\n)\nexport default App\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}